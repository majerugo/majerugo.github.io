---
layout: post
title: Cap
date: 2025-12-17 12:03 +0100
description: Web exploitation using captured network traffic and privilege escalation via misconfigured Python installation.
categories:
- Challenges
- HackTheBox
tags:
- hackthebox
- writeups
- linux
- easy
---

![Cap HackTheBox Writeup](/assets/img/hackthebox/cap/cap.png){: width="80" height="80" .right }

## Reconnaissance

Initial enumeration with Nmap to identify exposed services.

```bash
nmap -p- -sT <target_ip>
```

Common findings on this box:
- HTTP on port 80 hosting the application.
- SSH on port 22 for remote access.

## Exploitation

The web app exposes a PCAP download endpoint tied to your session. This is vulnerable to an insecure direct object reference (IDOR): the `id` parameter can be changed to access other sessions.

The interesting PCAP is the one with the id 0. You should download it.

Open the capture with Wireshark and filter for FTP traffic. The credentials are transmitted in cleartext.

![FTP Credentials in Wireshark](/assets/img/hackthebox/cap/ftp_login.png){: width="600" height="400" }

Use the recovered credentials to authenticate via SSH and obtain a shell:

```bash
ssh nathan@<target_ip>
```

## Privilege Escalation

Enumerate for misconfigurations and capabilities (LinPEAS helps here). A key finding on this host:

```bash
getcap -r / 2>/dev/null | grep python3.8
# /usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip
```

`cap_setuid` allows a process to set its user ID without the traditional SUID bit. We can leverage Python to switch to UID 0 and spawn a root shell:

```bash
python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash")'
```
And we are root!

## Takeaways

- IDOR on session-bound PCAP download exposes other users captures.
- Cleartext FTP credentials lead to SSH foothold.
- Misconfigured binary capabilities (`cap_setuid`) on Python enable root via a minimal one-liner.
